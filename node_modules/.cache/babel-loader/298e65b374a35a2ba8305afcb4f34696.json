{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/\\u0410\\u043D\\u0434\\u0440\\u0435\\u0439/Desktop/Vue 3 2021 \\u0412\\u043B\\u0430\\u0434\\u0438\\u043B\\u0435\\u043D \\u041C\\u0438\\u043D\\u0438\\u043D/014_2/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _objectSpread from \"C:/Users/\\u0410\\u043D\\u0434\\u0440\\u0435\\u0439/Desktop/Vue 3 2021 \\u0412\\u043B\\u0430\\u0434\\u0438\\u043B\\u0435\\u043D \\u041C\\u0438\\u043D\\u0438\\u043D/014_2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"C:/Users/\\u0410\\u043D\\u0434\\u0440\\u0435\\u0439/Desktop/Vue 3 2021 \\u0412\\u043B\\u0430\\u0434\\u0438\\u043B\\u0435\\u043D \\u041C\\u0438\\u043D\\u0438\\u043D/014_2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport axios from 'axios';\nimport { error } from '../../utils/error';\nvar TOKEN_KEY = 'jwt-token';\nexport default {\n  namespaced: true,\n  state: function state() {\n    return {\n      token: localStorage.getItem(TOKEN_KEY)\n    };\n  },\n  mutations: {\n    setToken: function setToken(state, token) {\n      state.token = token;\n      localStorage.setItem(TOKEN_KEY, token);\n    },\n    logout: function logout(state) {\n      state.token = null;\n      localStorage.removeItem(TOKEN_KEY);\n    }\n  },\n  actions: {\n    login: function login(_ref, payload) {\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var commit, dispatch, url, _yield$axios$post, data;\n\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                commit = _ref.commit, dispatch = _ref.dispatch;\n                _context.prev = 1;\n                url = \"https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=\".concat(process.env.VUE_APP_FB_KEY);\n                _context.next = 5;\n                return axios.post(url, _objectSpread(_objectSpread({}, payload), {}, {\n                  returnSecureToken: true\n                }));\n\n              case 5:\n                _yield$axios$post = _context.sent;\n                data = _yield$axios$post.data;\n                commit('setToken', data.idToken);\n                commit('clearMessage', null, {\n                  root: true\n                });\n                _context.next = 15;\n                break;\n\n              case 11:\n                _context.prev = 11;\n                _context.t0 = _context[\"catch\"](1);\n                dispatch('setMessage', {\n                  value: error(_context.t0.response.data.error.message),\n                  type: 'danger'\n                }, {\n                  root: true\n                });\n                throw new Error();\n\n              case 15:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[1, 11]]);\n      }))();\n    }\n  },\n  getters: {\n    token: function token(state) {\n      return state.token;\n    },\n    isAuthenticated: function isAuthenticated(_, getters) {\n      return !!getters.token;\n    }\n  }\n};","map":{"version":3,"names":["axios","error","TOKEN_KEY","namespaced","state","token","localStorage","getItem","mutations","setToken","setItem","logout","removeItem","actions","login","payload","commit","dispatch","url","process","env","VUE_APP_FB_KEY","post","returnSecureToken","data","idToken","root","value","response","message","type","Error","getters","isAuthenticated","_"],"sources":["C:/Users/Андрей/Desktop/Vue 3 2021 Владилен Минин/014_2/src/store/modules/auth.module.js"],"sourcesContent":["import axios from 'axios'\nimport {error} from '../../utils/error'\nconst TOKEN_KEY = 'jwt-token'\n\nexport default {\n  namespaced: true,\n  state() {\n    return {\n      token: localStorage.getItem(TOKEN_KEY)\n    }\n  },\n  mutations: {\n    setToken(state, token) {\n      state.token = token\n      localStorage.setItem(TOKEN_KEY, token)\n    },\n    logout(state) {\n      state.token = null\n      localStorage.removeItem(TOKEN_KEY)\n    }\n  },\n  actions: {\n    async login({ commit, dispatch }, payload) {\n      try {\n        const url = `https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=${process.env.VUE_APP_FB_KEY}`\n        const {data} = await axios.post(url, {...payload, returnSecureToken: true})\n        commit('setToken', data.idToken)\n        commit('clearMessage', null, {root: true})\n      } catch (e) {\n        dispatch('setMessage', {\n          value: error(e.response.data.error.message),\n          type: 'danger'\n        }, {root: true})\n        throw new Error()\n      }\n    }\n  },\n  getters: {\n    token(state) {\n      return state.token\n    },\n    isAuthenticated(_, getters) {\n      return !!getters.token\n    }\n  }\n}"],"mappings":";;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAAQC,KAAR,QAAoB,mBAApB;AACA,IAAMC,SAAS,GAAG,WAAlB;AAEA,eAAe;EACbC,UAAU,EAAE,IADC;EAEbC,KAFa,mBAEL;IACN,OAAO;MACLC,KAAK,EAAEC,YAAY,CAACC,OAAb,CAAqBL,SAArB;IADF,CAAP;EAGD,CANY;EAObM,SAAS,EAAE;IACTC,QADS,oBACAL,KADA,EACOC,KADP,EACc;MACrBD,KAAK,CAACC,KAAN,GAAcA,KAAd;MACAC,YAAY,CAACI,OAAb,CAAqBR,SAArB,EAAgCG,KAAhC;IACD,CAJQ;IAKTM,MALS,kBAKFP,KALE,EAKK;MACZA,KAAK,CAACC,KAAN,GAAc,IAAd;MACAC,YAAY,CAACM,UAAb,CAAwBV,SAAxB;IACD;EARQ,CAPE;EAiBbW,OAAO,EAAE;IACDC,KADC,uBAC2BC,OAD3B,EACoC;MAAA;QAAA;;QAAA;UAAA;YAAA;cAAA;gBAA7BC,MAA6B,QAA7BA,MAA6B,EAArBC,QAAqB,QAArBA,QAAqB;gBAAA;gBAEjCC,GAFiC,uFAEkDC,OAAO,CAACC,GAAR,CAAYC,cAF9D;gBAAA;gBAAA,OAGlBrB,KAAK,CAACsB,IAAN,CAAWJ,GAAX,kCAAoBH,OAApB;kBAA6BQ,iBAAiB,EAAE;gBAAhD,GAHkB;;cAAA;gBAAA;gBAGhCC,IAHgC,qBAGhCA,IAHgC;gBAIvCR,MAAM,CAAC,UAAD,EAAaQ,IAAI,CAACC,OAAlB,CAAN;gBACAT,MAAM,CAAC,cAAD,EAAiB,IAAjB,EAAuB;kBAACU,IAAI,EAAE;gBAAP,CAAvB,CAAN;gBALuC;gBAAA;;cAAA;gBAAA;gBAAA;gBAOvCT,QAAQ,CAAC,YAAD,EAAe;kBACrBU,KAAK,EAAE1B,KAAK,CAAC,YAAE2B,QAAF,CAAWJ,IAAX,CAAgBvB,KAAhB,CAAsB4B,OAAvB,CADS;kBAErBC,IAAI,EAAE;gBAFe,CAAf,EAGL;kBAACJ,IAAI,EAAE;gBAAP,CAHK,CAAR;gBAPuC,MAWjC,IAAIK,KAAJ,EAXiC;;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAa1C;EAdM,CAjBI;EAiCbC,OAAO,EAAE;IACP3B,KADO,iBACDD,KADC,EACM;MACX,OAAOA,KAAK,CAACC,KAAb;IACD,CAHM;IAIP4B,eAJO,2BAISC,CAJT,EAIYF,OAJZ,EAIqB;MAC1B,OAAO,CAAC,CAACA,OAAO,CAAC3B,KAAjB;IACD;EANM;AAjCI,CAAf"},"metadata":{},"sourceType":"module"}